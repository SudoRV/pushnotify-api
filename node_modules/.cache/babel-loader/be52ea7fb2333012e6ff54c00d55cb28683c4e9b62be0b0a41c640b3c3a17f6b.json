{"ast":null,"code":"import React,{useState,useEffect,useRef}from\"react\";import{requestNotificationPermission,getDeviceToken}from\"../functions/getDeviceToken\";import notification_on from\"../icons/notification_on.svg\";import notification_off from\"../icons/notification_off.svg\";import\"../styles/RegisterDevice.scss\";// Import styles\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const RegisterDevice=_ref=>{let{onToken}=_ref;const[deviceToken,setDeviceToken]=useState(\"\");const[notificationStatus,setNotificationStatus]=useState(Notification.permission);const preRef=useRef(null);const textRef=useRef(null);const iconRef=useRef(null);// Fetch saved token on mount\nuseEffect(()=>{const savedData=localStorage.getItem(\"t_data\");if(savedData){const{\"web-device-token\":storedToken}=JSON.parse(savedData);if(storedToken)setDeviceToken(storedToken);}},[]);const handleRegisterDevice=async()=>{await handleRequestPermission();if(deviceToken){navigator.clipboard.writeText(deviceToken);if(onToken)onToken(deviceToken);return;}const token=await getDeviceToken();if(token){setDeviceToken(token);const updatedData={...JSON.parse(localStorage.getItem(\"t_data\")||\"{}\"),\"web-device-token\":token};localStorage.setItem(\"t_data\",JSON.stringify(updatedData));}};const handleRequestPermission=async()=>{const isGranted=await requestNotificationPermission();setNotificationStatus(isGranted?\"granted\":\"denied\");// Show permission status temporarily\nif(preRef.current&&iconRef.current){preRef.current.classList.add(\"show-notification-status\");iconRef.current.classList.add(\"shake\");textRef.current.innerText=isGranted?\"Allowed\":\"Blocked\";setTimeout(()=>{preRef.current.classList.remove(\"show-notification-status\");iconRef.current.classList.remove(\"shake\");},4000);}};return/*#__PURE__*/_jsxs(\"div\",{className:\"register-device flex fdc api-step\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex jcsb aic\",children:[/*#__PURE__*/_jsx(\"h3\",{children:\"2\\uFE0F\\u20E3 Get Device Token\"}),/*#__PURE__*/_jsxs(\"div\",{ref:preRef,className:\"notification_cont flex jcfe aic\",children:[/*#__PURE__*/_jsx(\"p\",{ref:textRef,children:notificationStatus===\"granted\"?\"Allowed\":\"Blocked\"}),/*#__PURE__*/_jsx(\"img\",{ref:iconRef,className:\"notification_icon\",src:notificationStatus===\"granted\"?notification_on:notification_off,alt:\"Notification Status\",onClick:handleRequestPermission,style:{cursor:\"pointer\"}})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"w100 flex fdc\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"api-input\",placeholder:\"Device Token\",value:deviceToken,readOnly:true}),/*#__PURE__*/_jsx(\"button\",{onClick:handleRegisterDevice,className:\"api-btn\",children:deviceToken?\"Copy Token\":\"Register Device\"})]})]});};export default RegisterDevice;","map":{"version":3,"names":["React","useState","useEffect","useRef","requestNotificationPermission","getDeviceToken","notification_on","notification_off","jsx","_jsx","jsxs","_jsxs","RegisterDevice","_ref","onToken","deviceToken","setDeviceToken","notificationStatus","setNotificationStatus","Notification","permission","preRef","textRef","iconRef","savedData","localStorage","getItem","storedToken","JSON","parse","handleRegisterDevice","handleRequestPermission","navigator","clipboard","writeText","token","updatedData","setItem","stringify","isGranted","current","classList","add","innerText","setTimeout","remove","className","children","ref","src","alt","onClick","style","cursor","type","placeholder","value","readOnly"],"sources":["/data/data/com.termux/files/home/jWTFcm/clients/pushnotify-api/src/components/RegisterDevice.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from \"react\";\nimport { requestNotificationPermission, getDeviceToken } from \"../functions/getDeviceToken\";\n\nimport notification_on from \"../icons/notification_on.svg\";\nimport notification_off from \"../icons/notification_off.svg\";\nimport \"../styles/RegisterDevice.scss\"; // Import styles\n\nconst RegisterDevice = ({ onToken }) => {\n  const [deviceToken, setDeviceToken] = useState(\"\");\n  const [notificationStatus, setNotificationStatus] = useState(Notification.permission);  \n\n  const preRef = useRef(null);\n  const textRef = useRef(null);\n  const iconRef = useRef(null);\n\n  // Fetch saved token on mount\n  useEffect(() => {\n    const savedData = localStorage.getItem(\"t_data\");\n    if (savedData) {\n      const { \"web-device-token\": storedToken } = JSON.parse(savedData);\n      if (storedToken) setDeviceToken(storedToken);\n    }\n  }, []);\n\n  const handleRegisterDevice = async () => {\n    await handleRequestPermission();\n    \n    if (deviceToken) {\n      navigator.clipboard.writeText(deviceToken);\n      if (onToken) onToken(deviceToken);\n      return;\n    }\n\n    const token = await getDeviceToken();\n    if (token) {\n      setDeviceToken(token);\n      const updatedData = { ...JSON.parse(localStorage.getItem(\"t_data\") || \"{}\"), \"web-device-token\": token };\n      localStorage.setItem(\"t_data\", JSON.stringify(updatedData));\n    }\n  };\n\n  const handleRequestPermission = async () => {\n    const isGranted = await requestNotificationPermission();\n    setNotificationStatus(isGranted ? \"granted\" : \"denied\");\n\n    // Show permission status temporarily\n    if (preRef.current && iconRef.current) {\n      preRef.current.classList.add(\"show-notification-status\");\n      iconRef.current.classList.add(\"shake\");\n\n      textRef.current.innerText = isGranted ? \"Allowed\" : \"Blocked\";\n\n      setTimeout(() => {\n        preRef.current.classList.remove(\"show-notification-status\");\n        iconRef.current.classList.remove(\"shake\");\n      }, 4000);\n    }\n  };\n\n  return (\n    <div className=\"register-device flex fdc api-step\">\n      <div className=\"flex jcsb aic\">\n        <h3>2️⃣ Get Device Token</h3>\n        <div ref={preRef} className=\"notification_cont flex jcfe aic\">\n          <p ref={textRef}>{notificationStatus === \"granted\" ? \"Allowed\" : \"Blocked\"}</p>\n          <img \n            ref={iconRef} \n            className=\"notification_icon\"\n            src={notificationStatus === \"granted\" ? notification_on : notification_off} \n            alt=\"Notification Status\"\n            onClick={handleRequestPermission}\n            style={{ cursor: \"pointer\" }} \n          />\n        </div>\n      </div>\n\n      <div className=\"w100 flex fdc\">\n        <input type=\"text\" className=\"api-input\" placeholder=\"Device Token\" value={deviceToken} readOnly />\n        <button onClick={handleRegisterDevice} className=\"api-btn\">\n          {deviceToken ? \"Copy Token\" : \"Register Device\"}\n        </button>\n      </div>\n    </div>\n  );\n};\n\nexport default RegisterDevice;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}